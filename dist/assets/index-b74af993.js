var E=Object.defineProperty;var R=(l,e,t)=>e in l?E(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(R(l,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerpolicy&&(h.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?h.credentials="include":o.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=t(o);fetch(o.href,h)}})();class C{constructor(e){s(this,"options",{});s(this,"swipe","");s(this,"touchStartCenter",{x:0,y:0});s(this,"touchEndCenter",{x:0,y:0});s(this,"el",{id:"circle",style:{top:"0",left:"0",size:50,color:"#333333",opacity:"0.5",position:"absolute"}});s(this,"threshold",5);s(this,"move",{x:0,y:0});s(this,"readableDirection","center");s(this,"direction",{x:0,y:0});s(this,"isTouching",!1);this.options=e||{},this.createJoystickBg(),this.createJoystickElement()}distance(e,t){let i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)}createJoystickElement(){const e=document.createElement("div");e.setAttribute("id",this.el.id),e.style.top=this.el.style.top+"px",e.style.left=this.el.style.left+"px",e.style.width=this.el.style.size+"px",e.style.height=this.el.style.size+"px",e.style.backgroundColor=this.el.style.color,e.style.borderRadius="50%",e.style.position=this.el.style.position,e.style.opacity=this.el.style.opacity,e.style.visibility="hidden",document.body.appendChild(e)}createJoystickBg(){const e=document.createElement("div");e.setAttribute("id","joy_bg"),e.style.top="0",e.style.left="0",e.style.width="70px",e.style.height="70px",e.style.backgroundColor="#cccccc",e.style.borderRadius="50%",e.style.position="absolute",e.style.opacity="0.5",e.style.visibility="hidden",document.body.appendChild(e)}changeBodyStyle(){document.body.style.touchAction="none",document.body.style.position="relative"}init(){this.changeBodyStyle(),this.options.debug&&this.createDebugEl(),this.showDebug();const e=document.getElementById("circle"),t=document.getElementById("joy_bg");if(e){const h={x:0,y:0};let a=0,d=0;document.addEventListener("touchstart",n=>{if(n.preventDefault(),e&&t){this.isTouching=!0,h.x=n.touches[0].radiusX,h.y=n.touches[0].radiusY;const c=n.changedTouches[0].pageX-35-h.x,A=n.changedTouches[0].pageY-35-h.y;this.touchStartCenter.x=c,this.touchStartCenter.y=A,a=n.changedTouches[0].screenX,d=n.changedTouches[0].screenY,document.body.style.overflow="hidden",e.style.visibility="visible",e.style.top=n.changedTouches[0].pageY-25-h.y+"px",e.style.left=n.changedTouches[0].pageX-25-h.x+"px",t.style.visibility="visible",t.style.top=A+"px",t.style.left=c+"px",this.dispatchEvent(),this.showDebug()}}),document.addEventListener("touchmove",n=>{n.preventDefault();const c={x:n.changedTouches[0].pageX-25-h.x,y:n.changedTouches[0].pageY-25-h.y},A=this.distance(this.touchStartCenter,{x:c.x,y:c.y}),u=Math.atan2(c.y-this.touchStartCenter.y,c.x-this.touchStartCenter.x);if(A>35){const f=this.touchStartCenter.x+35*Math.cos(u),p=this.touchStartCenter.y+35*Math.sin(u);e.style.left=f+"px",e.style.top=p+"px"}else e.style.top=c.y+"px",e.style.left=c.x+"px";const w=n.changedTouches[0].screenX,r=n.changedTouches[0].screenY,g=w-a,m=r-d;Math.abs(g)>Math.abs(m)+this.threshold?(this.direction.x=g>this.threshold?1:g<-this.threshold?-1:0,this.direction.y=m>this.threshold?1:m<-this.threshold?-1:0,g<0?(this.move.x=-1,this.move.y=0):(this.move.x=1,this.move.y=0)):Math.abs(g)+this.threshold<Math.abs(m)?(this.direction.y=m>this.threshold?-1:m<-this.threshold?1:0,this.direction.x=g>this.threshold?-1:g<-this.threshold?1:0,m<0?(this.move.y=-1,this.move.x=0):(this.move.y=1,this.move.x=0)):(this.move.x=0,this.move.y=0,this.direction.x=0,this.direction.y=0),this.move.x>0&&(this.readableDirection="right",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight"}))),this.move.x<0&&(this.readableDirection="left",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft"}))),this.move.y>0&&(this.readableDirection="down",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))),this.move.y<0&&(this.readableDirection="up",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))),this.move.x===0&&this.move.y===0&&(this.readableDirection="center"),this.dispatchEvent(),this.showDebug()}),document.addEventListener("touchend",()=>{e&&t&&(document.body.style.overflow="auto",e.style.visibility="hidden",t.style.visibility="hidden",this.isTouching=!1,this.dispatchEvent(),this.showDebug())})}}createDebugEl(){const e=document.createElement("div");e.setAttribute("id","debug"),document.body.appendChild(e)}showDebug(){const e=document.getElementById("debug");if(e&&this.options.debug===!0){let t="";for(const i in this.eventPayload)t+=`<p>${i}: ${JSON.stringify(this.eventPayload[i])}</p>`;e.innerHTML=t}}dispatchEvent(){window.dispatchEvent(new CustomEvent("v-joystick",{detail:this.eventPayload}))}get eventPayload(){return{move:this.move,direction:this.direction,isTouching:this.isTouching,readableDirection:this.readableDirection}}}const T=(l,e)=>Math.floor(Math.random()*(e-l+1))+l,y=(l,e)=>Math.floor(Math.sqrt((l.x-e.x)**2+(l.y-e.y)**2)),v=(l=30,e=26,t=10)=>{const i=Math.floor(Math.random()*e)*t,o=Math.floor(Math.random()*l)*t;return{x:i,y:o}};class z{constructor(e){s(this,"game");this.game=e,window.addEventListener("keydown",t=>{t.preventDefault(),this.changeDirection(t.key),this.shoot(t.key)})}changeDirection(e){const t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};if(t[e]){const[i,o]=this.game.direction;let h=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];i&&(h=h.filter(a=>!["ArrowLeft","ArrowRight"].includes(a))),o&&(h=h.filter(a=>!["ArrowUp","ArrowDown"].includes(a))),h.includes(e)&&(this.game.direction=t[e])}}shoot(e){e===" "&&(this.game.direction[0]||this.game.direction[1])&&this.game.snek.shoot()}}class k{constructor(e,t,i,o){s(this,"x",0);s(this,"y",0);s(this,"height",0);s(this,"width",0);this.x=e,this.y=t,this.height=i,this.width=o}}class I{constructor(e,t,i){s(this,"x",0);s(this,"y",0);s(this,"height",0);s(this,"width",0);s(this,"game");this.x=e,this.y=t,this.height=i.blockSize,this.width=i.blockSize,this.game=i}update(){const[e,t]=this.game.direction;this.x+=e*(this.game.blockSize+this.game.blockSize/4),this.y+=t*(this.game.blockSize+this.game.blockSize/4)}draw(e){e.fillStyle="black",e.fillRect(this.x,this.y,this.height,this.width),e.strokeStyle="white",e.lineWidth=4,e.strokeRect(this.x,this.y,this.height,this.width)}}class U{constructor(e){s(this,"game");s(this,"speed",0);s(this,"head");s(this,"segments",[]);this.game=e,this.head=new k(5*this.game.blockSize,10*this.game.blockSize,this.game.blockSize,this.game.blockSize)}update(){const[e,t]=this.game.direction;this.die(),this.eat(this.game.food);const i=this.head;for(let o=0;o<this.segments.length;o++)this.segments.length===1?this.segments[o]={...i}:this.segments[o]={...this.segments[o+1]};this.segments.length>1&&(this.segments[this.segments.length-1]=new k(i.x,i.y,i.height,i.width)),i.x+=e*this.game.blockSize,i.y+=t*this.game.blockSize,i.x<0&&(i.x=this.game.canvas.width-this.game.blockSize),i.x>this.game.canvas.width-this.game.blockSize&&(i.x=0),i.y<0&&(i.y=this.game.canvas.height-this.game.blockSize),i.y>this.game.canvas.height-this.game.blockSize&&(i.y=0)}draw(e){e.fillStyle="#ffffff",e.strokeStyle="#000000";for(let t=0;t<this.segments.length;t++)e.lineWidth=4,e.fillRect(this.head.x,this.head.y,this.head.height,this.head.width),e.strokeRect(this.segments[t].x,this.segments[t].y,this.segments[t].height,this.segments[t].width);e.lineWidth=4,e.fillRect(this.head.x,this.head.y,this.head.height,this.head.width),e.strokeRect(this.head.x,this.head.y,this.head.height,this.head.width)}eat(e){const t=this.head,i=y({x:e.x,y:e.y},{x:t.x,y:t.y}),o=e.type;if(i===0){this.segments.push(new k(e.x,e.y,t.height,t.width)),this.game.score+=1,e.randomPosition();const h=+this.game.ui.speed.innerText;switch(o){case"normal":this.game.stepInterval>0&&(this.game.stepInterval-=2,this.game.ui.speed.innerText=(h+1).toString());default:break;case"decreaseSpeed":this.game.stepInterval>50?(this.game.stepInterval+=2,this.game.ui.speed.innerText=(h-1).toString()):(this.game.stepInterval+=10,this.game.ui.speed.innerText=(h-5).toString());break;case"firePower":this.game.availableBullets+=5,this.game.stepInterval>0&&(this.game.stepInterval-=2,this.game.ui.speed.innerText=(h+1).toString());break}}}die(){for(let e=0;e<this.segments.length;e++)y(this.head,this.segments[e])===0&&this.game.reset()}shoot(){const{x:e,y:t}=this.head;if(this.game.bullets.length===0){const i={direction:this.game.direction,blockSize:this.game.blockSize};this.game.availableBullets>0&&(this.game.bullets.push(new I(e,t,i)),this.game.availableBullets-=1)}}}class M{constructor(e){s(this,"game");s(this,"x",0);s(this,"y",0);s(this,"type","normal");this.game=e,this.randomPosition()}update(){const e=this.game.bullets;for(const t of e)y({x:this.x,y:this.y},t)<=10&&(this.randomPosition(),this.game.bullets=[])}draw(e){switch(this.type){case"normal":default:e.fillStyle="black",e.rect(this.x,this.y,this.game.blockSize,this.game.blockSize),e.fill();break;case"decreaseSpeed":e.fillStyle="green",e.rect(this.x,this.y,this.game.blockSize,this.game.blockSize),e.fill();break;case"firePower":e.strokeStyle="red",e.strokeRect(this.x,this.y,this.game.blockSize,this.game.blockSize);break}}randomPosition(){let{x:e,y:t}=v(this.game.rows,this.game.columns,this.game.blockSize);const i=this.game.snek.segments,o=["normal","normal","normal","normal","normal","normal","normal","normal","normal","normal","firePower","decreaseSpeed"];this.type=o[Math.floor(Math.random()*(o.length-1-0+1))+0];for(const a of i)if(y({x:e,y:t},a)===0){const n=v(this.game.rows,this.game.columns,this.game.blockSize);e=n.x,t=n.y}const h=this.game.obstacles;for(const a of h)if(y({x:e,y:t},a)===0){const n=v(this.game.rows,this.game.columns,this.game.blockSize);e=n.x,t=n.y}this.x=e,this.y=t}}class D{constructor(e,t,i){s(this,"canvasWidth",0);s(this,"canvasHeight",0);s(this,"speed",null);s(this,"score",null);s(this,"rockets",null);s(this,"game");this.game=i,this.canvasWidth=e,this.canvasHeight=t,this.score=document.getElementById("score"),this.speed=document.getElementById("speed"),this.rockets=document.getElementById("rockets")}update(){this.score.innerText=this.game.score.toString(),this.rockets.innerText=this.game.availableBullets.toString()}grid(e){e.lineWidth=1;for(let t=0;t<this.canvasWidth;t+=this.game.blockSize)e.beginPath(),e.strokeStyle="#d3d3d3",e.moveTo(t,0),e.lineTo(t,this.canvasHeight),e.stroke();for(let t=0;t<this.canvasHeight;t+=this.game.blockSize)e.beginPath(),e.moveTo(0,t),e.lineTo(this.canvasWidth,t),e.stroke()}draw(e){this.grid(e)}}class Q{constructor(e,t,i,o){s(this,"blockSize",10);s(this,"rows",0);s(this,"columns",0);s(this,"obstacles");s(this,"bullets",[]);s(this,"snek");s(this,"food");s(this,"input");s(this,"direction",[0,0]);s(this,"availableBullets",10);s(this,"score",0);s(this,"timeToNextStep",0);s(this,"stepInterval",150);s(this,"lastTime",0);s(this,"canvas");s(this,"ui");this.blockSize=i,this.rows=e,this.columns=t,this.obstacles=[],this.snek=new U(this),this.food=new M(this),this.input=new z(this),this.canvas=o,this.ui=new D(o.width,o.height,this),this.createObstacles()}update(){this.ui.update(),this.snek.update(),this.food.update();for(const e of this.obstacles)e.update();for(let e=0;e<this.bullets.length;e++)this.bullets[e].update();this.bullets=this.bullets.filter(e=>!(e.x>this.canvas.width||e.x<0||e.y<0||e.y>this.canvas.height))}draw(e){this.ui.draw(e),this.snek.draw(e),this.food.draw(e);for(const[t,i]of this.obstacles.entries())i.index=t,i.draw(e);for(let t=0;t<this.bullets.length;t++)this.bullets[t].draw(e)}getObstacleCoords(){const e=[new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAALZJREFUSInt1kEOwzAIRFGmyv2vTDeNA/iTKl25SrIEniOZWVhu17/XD2YJJF1Hcm9Vh+RmrWqQ3KxXjPTZXqMQaWycFSGFlKACpJQsUjNSSSOoCVVDqqLZgCqIzKwyYjOphDpTVZwLDe9L3eGhiP0nEYxWS0REvSkqoDOT1YHOTVKCaMZwYpnOTzUaeLKH6MbZG+ibiWqfLZeKMR7lrUzVWfz/Cm+j/0Ubl2Vu05aO7q0evkugNy10WnHWA3x8AAAAAElFTkSuQmCC",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAAEBJREFUSIlj/M9AOmAiQ8+oplFNA6aJBcFkxKsQOTcwjmYNCjSNBjnVNTEikbS1aVTTqCY6aBrN7qOaRjWNGE0AwBsGd+RNA1gAAAAASUVORK5CYII=",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAAOxJREFUSIntlUsSxCAIROlU7n/lnoUwoEFHU/NbyCaa8KTBgoCybscNZkMb+jcImISCH8gRdQRH+FJkRIFhoZv6EYXomzPCenrazODlOGSO8WXlN1tyEwGH0kB1LeLm6DNS3YKwlALihehoyiszhMwbDeYQhCIojo0XBcJQ9FMGKbWYmZecLBGg61Rqck8QKtVhLjnZh5FWTWSpCS35z7e7Kf/5YEnteRfflTccV2+NtByqRJqivINU3gQVuq6asLPmvvBuL9dYD4h46Bl5m+ege4NxzBcL7d5GJ9H5gWSpvExvJf9E3oY2dBt6AG9HWnFG4oFSAAAAAElFTkSuQmCC",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAAIpJREFUSIntVkEKwCAMW0f//+XtNoUm1Y0N47AnkaZgTJvasd2P/QFGHeTV2dLMijEn9yHqiuJELNCPQU7uiz6BihnoykX9Ik7Eq+yVAEw0QWhuCLwpPIXNPZwSi8z0udABGq0B5//Y1qCmlnkVM7XUFT/WXgcoXWTGaK97txJvDQHBZmFrh50CdAK6lQ+TqvZiiwAAAABJRU5ErkJggg==",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAAGpJREFUSIlj/M9AOmAiQ8+w1MQCpRlRhf9jE4QJwzUxYAt6dDGYIYM8IEY1jThNjCgULW0adJqIKjNhioaIn2inCb0Iw5ViKLeJBpr+o1C0tGlU06gm2muCNz6wNllw5E3G0UbiqCbKNQEA6EMLe+jPy5YAAAAASUVORK5CYII=",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAADZJREFUSIlj/M9AOmAiQ8+opqGniRGfOhTJoeOnUU2jmkY1jWoa1TSqiQBgHG0bjWoa1UQ1TQCyQQJ3DZHfVwAAAABJRU5ErkJggg==",self.location).href,new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA8CAAAAAAMQMZaAAAAAXNSR0IArs4c6QAAAG5JREFUSIntlsEKwDAIQ+Pw/395u2wga3S0u0hJTkX6ekhS0E7M61hgBO0MeThbeTP0zZP5oPhicyME/YGczF51GnvCoLJOQHsjmkPUcgDl58+hIqzmRgi6RcPNyvDkzaDPfaS5EUuQaQsTtD10AYIuCYNaYEoMAAAAAElFTkSuQmCC",self.location).href],t=new Image;t.src=e[T(0,e.length-1)];const i=document.getElementById("load-image-canvas"),o=i.getContext("2d"),h=[];return new Promise(d=>{t.addEventListener("load",()=>{if(o){i.width=t.width,i.height=t.height,o.drawImage(t,0,0);const n=o.getImageData(0,0,this.canvas.width,this.canvas.height),c=n.data,A=n.width,u=n.height,w=A*u;for(let r=0;r<w;r++){const g=c[r*4],m=c[r*4+1],f=c[r*4+2],p=c[r*4+3];if(g===0&&m===0&&f===0&&p===255){const S=Math.trunc(r/A),x=r-S*A;h.push({x,y:S})}}d(h)}})})}async createObstacles(){const e=await this.getObstacleCoords();for(const t of e)this.obstacles.push(new B(t.x*this.blockSize,t.y*this.blockSize,this))}reset(){this.snek.segments=[],this.direction=[0,0],this.score=0,this.stepInterval=150,this.availableBullets=10,this.bullets=[],this.snek.head.x+=5*this.blockSize,this.snek.head.y+=3*this.blockSize,this.ui.speed.innerText="0",this.obstacles=[],this.createObstacles(),this.update()}}class B{constructor(e,t,i){s(this,"x",0);s(this,"y",0);s(this,"index",0);s(this,"game");this.x=e,this.y=t,this.index=0,this.game=i}draw(e){e.lineWidth=2,e.strokeStyle="#000000",e.strokeRect(this.x,this.y,this.game.blockSize,this.game.blockSize)}update(){this.handleCollision()}handleCollision(){y(this.game.snek.head,this)<this.game.blockSize&&this.game.reset();for(const t of this.game.bullets)if(y(t,this)<=this.game.blockSize/2)for(const[o,h]of this.game.obstacles.entries()){const a=y(this,h);a>=0&&a<=this.game.blockSize*2&&(this.game.obstacles.splice(o,1),this.game.score+=2,this.game.bullets=[])}}}const N=new C;N.init();window.addEventListener("v-joystick",l=>{const{x:e,y:t}=l.detail.move;t<0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"})),t>0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"})),e<0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft"})),e>0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight"}))});const b=document.getElementById("fire");b&&b.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:" "}))});const L=()=>{const i=document.getElementById("canvas");i.style.width=`${12*26}px`,i.style.height=`${12*30}px`;const o=i.getContext("2d"),h=window.devicePixelRatio;i.width=Math.floor(26*12*h),i.height=Math.floor(30*12*h);const a=new Q(30,26,12,i),d=(n=0)=>{o.clearRect(0,0,i.width,i.height);let c=n-a.lastTime;a.lastTime=n,a.timeToNextStep+=c,a.draw(o),a.timeToNextStep>a.stepInterval&&(a.update(),a.timeToNextStep=0,a.availableBullets>0&&(a.direction[0]||a.direction[1])?b.style.visibility="visible":b.style.visibility="hidden"),window.requestAnimationFrame(d)};d()};window.addEventListener("load",L);
