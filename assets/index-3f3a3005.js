var C=Object.defineProperty;var R=(n,e,t)=>e in n?C(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>(R(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const l of h.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerpolicy&&(h.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?h.credentials="include":o.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=t(o);fetch(o.href,h)}})();class D{constructor(e){s(this,"options",{});s(this,"swipe","");s(this,"touchStartCenter",{x:0,y:0});s(this,"touchEndCenter",{x:0,y:0});s(this,"el",{id:"circle",style:{top:"0",left:"0",size:50,color:"#333333",opacity:"0.5",position:"absolute"}});s(this,"threshold",5);s(this,"move",{x:0,y:0});s(this,"readableDirection","center");s(this,"direction",{x:0,y:0});s(this,"isTouching",!1);this.options=e||{},this.createJoystickBg(),this.createJoystickElement()}distance(e,t){let i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)}createJoystickElement(){const e=document.createElement("div");e.setAttribute("id",this.el.id),e.style.top=this.el.style.top+"px",e.style.left=this.el.style.left+"px",e.style.width=this.el.style.size+"px",e.style.height=this.el.style.size+"px",e.style.backgroundColor=this.el.style.color,e.style.borderRadius="50%",e.style.position=this.el.style.position,e.style.opacity=this.el.style.opacity,e.style.visibility="hidden",document.body.appendChild(e)}createJoystickBg(){const e=document.createElement("div");e.setAttribute("id","joy_bg"),e.style.top="0",e.style.left="0",e.style.width="70px",e.style.height="70px",e.style.backgroundColor="#cccccc",e.style.borderRadius="50%",e.style.position="absolute",e.style.opacity="0.5",e.style.visibility="hidden",document.body.appendChild(e)}changeBodyStyle(){document.body.style.touchAction="none",document.body.style.position="relative"}init(){this.changeBodyStyle(),this.options.debug&&this.createDebugEl(),this.showDebug();const e=document.getElementById("circle"),t=document.getElementById("joy_bg");if(e){const h={x:0,y:0};let l=0,r=0;document.addEventListener("touchstart",a=>{if(a.preventDefault(),e&&t){this.isTouching=!0,h.x=a.touches[0].radiusX,h.y=a.touches[0].radiusY;const d=a.changedTouches[0].pageX-35-h.x,u=a.changedTouches[0].pageY-35-h.y;this.touchStartCenter.x=d,this.touchStartCenter.y=u,l=a.changedTouches[0].screenX,r=a.changedTouches[0].screenY,document.body.style.overflow="hidden",e.style.visibility="visible",e.style.top=a.changedTouches[0].pageY-25-h.y+"px",e.style.left=a.changedTouches[0].pageX-25-h.x+"px",t.style.visibility="visible",t.style.top=u+"px",t.style.left=d+"px",this.dispatchEvent(),this.showDebug()}}),document.addEventListener("touchmove",a=>{a.preventDefault();const d={x:a.changedTouches[0].pageX-25-h.x,y:a.changedTouches[0].pageY-25-h.y},u=this.distance(this.touchStartCenter,{x:d.x,y:d.y}),f=Math.atan2(d.y-this.touchStartCenter.y,d.x-this.touchStartCenter.x);if(u>35){const E=this.touchStartCenter.x+35*Math.cos(f),T=this.touchStartCenter.y+35*Math.sin(f);e.style.left=E+"px",e.style.top=T+"px"}else e.style.top=d.y+"px",e.style.left=d.x+"px";const k=a.changedTouches[0].screenX,z=a.changedTouches[0].screenY,g=k-l,m=z-r;Math.abs(g)>Math.abs(m)+this.threshold?(this.direction.x=g>this.threshold?1:g<-this.threshold?-1:0,this.direction.y=m>this.threshold?1:m<-this.threshold?-1:0,g<0?(this.move.x=-1,this.move.y=0):(this.move.x=1,this.move.y=0)):Math.abs(g)+this.threshold<Math.abs(m)?(this.direction.y=m>this.threshold?-1:m<-this.threshold?1:0,this.direction.x=g>this.threshold?-1:g<-this.threshold?1:0,m<0?(this.move.y=-1,this.move.x=0):(this.move.y=1,this.move.x=0)):(this.move.x=0,this.move.y=0,this.direction.x=0,this.direction.y=0),this.move.x>0&&(this.readableDirection="right",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight"}))),this.move.x<0&&(this.readableDirection="left",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft"}))),this.move.y>0&&(this.readableDirection="down",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))),this.move.y<0&&(this.readableDirection="up",window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))),this.move.x===0&&this.move.y===0&&(this.readableDirection="center"),this.dispatchEvent(),this.showDebug()}),document.addEventListener("touchend",()=>{e&&t&&(document.body.style.overflow="auto",e.style.visibility="hidden",t.style.visibility="hidden",this.isTouching=!1,this.dispatchEvent(),this.showDebug())})}}createDebugEl(){const e=document.createElement("div");e.setAttribute("id","debug"),document.body.appendChild(e)}showDebug(){const e=document.getElementById("debug");if(e&&this.options.debug===!0){let t="";for(const i in this.eventPayload)t+=`<p>${i}: ${JSON.stringify(this.eventPayload[i])}</p>`;e.innerHTML=t}}dispatchEvent(){window.dispatchEvent(new CustomEvent("v-joystick",{detail:this.eventPayload}))}get eventPayload(){return{move:this.move,direction:this.direction,isTouching:this.isTouching,readableDirection:this.readableDirection}}}const A=(n,e)=>Math.floor(Math.random()*(e-n+1))+n,I=new D;I.init();window.addEventListener("v-joystick",n=>{const{x:e,y:t}=n.detail.move;t<0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"})),t>0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"})),e<0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowLeft"})),e>0&&window.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowRight"}))});const c=document.getElementById("canvas"),w=new Image;w.crossOrigin="Anonymous";w.src=`./src/imgs/${A(0,10)}.png`;const x=[];w.addEventListener("load",()=>{const n=document.getElementById("load-image-canvas"),e=n.getContext("2d");if(e){n.width=w.width,n.height=w.height,e.drawImage(w,0,0);const t=e.getImageData(0,0,c.width,c.height),i=t.data,o=t.width,h=t.height,l=o*h;for(let r=0;r<l;r++){const a=i[r*4],d=i[r*4+1],u=i[r*4+2];if(a===0&&d===0&&u===0){const f=Math.trunc(r/o),k=r-f*o;x.push({x:k,y:f})}}}});const M=document.getElementById("score"),B=document.getElementById("rockets"),p=document.getElementById("fire"),b=document.getElementById("speed");p&&p.addEventListener("click",()=>{window.dispatchEvent(new KeyboardEvent("keydown",{key:" "}))});const y=(n,e)=>Math.floor(Math.sqrt((n.x-e.x)**2+(n.y-e.y)**2)),v=(n=30,e=26,t=10)=>{const i=Math.floor(Math.random()*e)*t,o=Math.floor(Math.random()*n)*t;return{x:i,y:o}};class L{constructor(e){s(this,"blockSize",10);this.blockSize=e||10}update(){this.blockSize=this.blockSize}grid(e){e.lineWidth=1;for(let t=0;t<c.width;t+=this.blockSize)e.beginPath(),e.strokeStyle="#d3d3d3",e.moveTo(t,0),e.lineTo(t,c.height),e.stroke();for(let t=0;t<c.height;t+=this.blockSize)e.beginPath(),e.moveTo(0,t),e.lineTo(c.width,t),e.stroke()}draw(e){this.grid(e)}}class P{constructor(e){s(this,"game");this.game=e,window.addEventListener("keydown",t=>{t.preventDefault(),this.changeDirection(t.key),this.shoot(t.key)})}changeDirection(e){const t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};if(t[e]){const[i,o]=this.game.direction;let h=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];i&&(h=h.filter(l=>!["ArrowLeft","ArrowRight"].includes(l))),o&&(h=h.filter(l=>!["ArrowUp","ArrowDown"].includes(l))),h.includes(e)&&(this.game.direction=t[e])}}shoot(e){e===" "&&(this.game.direction[0]||this.game.direction[1])&&this.game.snek.shoot()}}class S{constructor(e,t,i,o){s(this,"x",0);s(this,"y",0);s(this,"height",0);s(this,"width",0);this.x=e,this.y=t,this.height=i,this.width=o}}class X{constructor(e,t,i){s(this,"x",0);s(this,"y",0);s(this,"height",0);s(this,"width",0);s(this,"game");this.x=e,this.y=t,this.height=i.blockSize,this.width=i.blockSize,this.game=i}update(){const[e,t]=this.game.direction;this.x+=e*(this.game.blockSize+this.game.blockSize/4),this.y+=t*(this.game.blockSize+this.game.blockSize/4)}draw(e){e.fillStyle="black",e.fillRect(this.x,this.y,this.height,this.width),e.strokeStyle="white",e.lineWidth=4,e.strokeRect(this.x,this.y,this.height,this.width)}}class Y{constructor(e,t,i){s(this,"x",0);s(this,"y",0);s(this,"index",0);s(this,"game");this.x=e,this.y=t,this.index=0,this.game=i}draw(e){e.lineWidth=2,e.strokeStyle="#000000",e.strokeRect(this.x,this.y,this.game.blockSize,this.game.blockSize)}update(){this.handleCollision()}randomPosition(){}handleCollision(){y(this.game.snek.head,this)<this.game.blockSize&&this.game.reset();for(const t of this.game.bullets)y(t,this)<=this.game.blockSize/2&&(this.game.score+=2,this.game.obstacles.splice(this.index,1),this.game.bullets=[])}}class K{constructor(e){s(this,"game");s(this,"speed",0);s(this,"head");s(this,"segments",[]);this.game=e,this.head=new S(5*this.game.blockSize,10*this.game.blockSize,this.game.blockSize,this.game.blockSize)}update(){const[e,t]=this.game.direction;this.die(),this.eat(this.game.food);const i=this.head;for(let o=0;o<this.segments.length;o++)this.segments.length===1?this.segments[o]={...i}:this.segments[o]={...this.segments[o+1]};this.segments.length>1&&(this.segments[this.segments.length-1]=new S(i.x,i.y,i.height,i.width)),i.x+=e*this.game.blockSize,i.y+=t*this.game.blockSize,i.x<0&&(i.x=this.game.width-this.game.blockSize),i.x>this.game.width-this.game.blockSize&&(i.x=0),i.y<0&&(i.y=this.game.height-this.game.blockSize),i.y>this.game.height-this.game.blockSize&&(i.y=0)}draw(e){e.fillStyle="#ffffff",e.strokeStyle="#000000";for(let t=0;t<this.segments.length;t++)e.lineWidth=4,e.fillRect(this.head.x,this.head.y,this.head.height,this.head.width),e.strokeRect(this.segments[t].x,this.segments[t].y,this.segments[t].height,this.segments[t].width);e.lineWidth=4,e.fillRect(this.head.x,this.head.y,this.head.height,this.head.width),e.strokeRect(this.head.x,this.head.y,this.head.height,this.head.width)}eat(e){const t=this.head,i=y({x:e.x,y:e.y},{x:t.x,y:t.y}),o=e.type;if(i===0){this.segments.push(new S(e.x,e.y,t.height,t.width)),this.game.score+=1,e.randomPosition();const h=+b.innerText;switch(o){case"normal":this.game.stepInterval>0&&(this.game.stepInterval-=2,b.innerText=(h+1).toString());default:break;case"decreaseSpeed":this.game.stepInterval>50?(this.game.stepInterval+=2,b.innerText=(h-1).toString()):(this.game.stepInterval+=10,b.innerText=(h-5).toString());break;case"firePower":this.game.availableBullets=3,this.game.stepInterval>0&&(this.game.stepInterval-=2,b.innerText=(h+1).toString());break}}}die(){for(let e=0;e<this.segments.length;e++)y(this.head,this.segments[e])===0&&this.game.reset()}shoot(){const{x:e,y:t}=this.head;if(this.game.bullets.length===0){const i={direction:this.game.direction,blockSize:this.game.blockSize};this.game.availableBullets>0&&(this.game.bullets.push(new X(e,t,i)),this.game.availableBullets-=1)}}}class O{constructor(e){s(this,"game");s(this,"x",0);s(this,"y",0);s(this,"type","normal");this.game=e,this.randomPosition()}update(){const e=this.game.bullets;for(const t of e)y({x:this.x,y:this.y},t)<=10&&(this.randomPosition(),this.game.bullets=[])}draw(e){switch(this.type){case"normal":default:e.fillStyle="black",e.rect(this.x,this.y,this.game.blockSize,this.game.blockSize),e.fill();break;case"decreaseSpeed":e.fillStyle="green",e.rect(this.x,this.y,this.game.blockSize,this.game.blockSize),e.fill();break;case"firePower":e.strokeStyle="red",e.strokeRect(this.x,this.y,this.game.blockSize,this.game.blockSize);break}}randomPosition(){let{x:e,y:t}=v(this.game.rows,this.game.columns,this.game.blockSize);const i=this.game.snek.segments,o=["normal","normal","normal","normal","normal","normal","normal","normal","normal","normal","firePower","decreaseSpeed"];this.type=o[Math.floor(Math.random()*(o.length-1-0+1))+0];for(const l of i)if(y({x:e,y:t},l)===0){const a=v(this.game.rows,this.game.columns,this.game.blockSize);e=a.x,t=a.y}const h=this.game.obstacles;for(const l of h)if(y({x:e,y:t},l)===0){const a=v(this.game.rows,this.game.columns,this.game.blockSize);e=a.x,t=a.y}this.x=e,this.y=t}}class N{constructor(e,t,i,o,h){s(this,"blockSize",10);s(this,"rows",0);s(this,"columns",0);s(this,"width",0);s(this,"height",0);s(this,"obstacles",[]);s(this,"bullets",[]);s(this,"snek");s(this,"food");s(this,"input");s(this,"direction",[0,0]);s(this,"availableBullets",3);s(this,"score",0);s(this,"timeToNextStep",0);s(this,"stepInterval",200);s(this,"lastTime",0);this.blockSize=h,this.rows=e,this.columns=t,this.width=i,this.height=o,this.obstacles=this.createObstacles(),this.snek=new K(this),this.food=new O(this),this.input=new P(this)}update(){this.snek.update(),this.food.update();for(const e of this.obstacles)e.update();for(let e=0;e<this.bullets.length;e++)this.bullets[e].update();this.bullets=this.bullets.filter(e=>!(e.x>this.width||e.x<0||e.y<0||e.y>this.height))}draw(e){this.snek.draw(e),this.food.draw(e);for(const[t,i]of this.obstacles.entries())i.index=t,i.draw(e);for(let t=0;t<this.bullets.length;t++)this.bullets[t].draw(e)}createObstacles(){const e=[];for(const t of x)e.push(new Y(t.x*this.blockSize,t.y*this.blockSize,this));return e}reset(){this.snek.segments=[],this.direction=[0,0],this.score=0,this.stepInterval=100,this.availableBullets=0,this.bullets=[],this.snek.head.x+=5*this.blockSize,this.snek.head.y+=3*this.blockSize,b.innerText="0",this.createObstacles(),this.update()}}window.addEventListener("load",function(){const i=c.getContext("2d");c.style.width=`${12*26}px`,c.style.height=`${12*30}px`;const o=window.devicePixelRatio;c.width=Math.floor(26*12*o),c.height=Math.floor(30*12*o);const h=new L(12),l=new N(30,26,c.width,c.height,12);function r(a=0){i.clearRect(0,0,c.width,c.height);let d=a-l.lastTime;l.lastTime=a,l.timeToNextStep+=d,h.draw(i),l.draw(i),l.timeToNextStep>l.stepInterval&&(l.update(),l.timeToNextStep=0,M.innerText=l.score.toString(),B.innerText=l.availableBullets.toString(),l.availableBullets>0&&(l.direction[0]||l.direction[1])?p.style.visibility="visible":p.style.visibility="hidden"),window.requestAnimationFrame(r)}r()});
